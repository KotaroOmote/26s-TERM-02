# 実験更新メモ（2026-02-16）

前日報告（`250216.pdf`）に対する当日追補。  
ここでは、GitHub上の再現スクリプトと一致する数値のみを記録する。

## 1. 軸構築（4変数）
- データ: `food101(10000)` + `cifar100(5000)` + `imagenet_r(5000)`
- 特徴量: `d_conf_drop`, `d_entropy_gain`, `d_energy_gain`, `d_oodscore_gain`
- SparsePCA + CV + 1SE:
  - `k_selected = 3`
  - `alpha_selected = 1.0`
  - `axis_u_index = 2`
  - `axis_c_index = 0`
- 軸式:
  - `z_u = +1.0000*d_entropy_gain`
  - `z_c = +0.7071*d_conf_drop +0.7071*d_oodscore_gain`

## 2. A) 判定性能比較（95%CI付き）
| model | AUROC | AUROC 95%CI | TNR@95TPR | TNR@95TPR 95%CI |
|---|---:|---|---:|---|
| energy_single | 0.996254 | [0.994955, 0.997424] | 0.996000 | [0.993021, 0.998002] |
| logistic_2d | 0.941065 | [0.934870, 0.946460] | 0.687000 | [0.649121, 0.726301] |
| linear_svm | 0.941045 | [0.934851, 0.946450] | 0.687333 | [0.647829, 0.726287] |
| zsum_1d | 0.907249 | [0.900101, 0.914356] | 0.598667 | [0.566543, 0.633346] |
| msp_single | 0.886241 | [0.878169, 0.894477] | 0.578000 | [0.540523, 0.607400] |

要点:
- 二値OoDの最良性能は `energy_single`。
- `z_u,z_c` による2次元判定は、性能を確保しつつ説明可能な失敗分析に接続できる。

## 3. B) `z_u-z_c` 四象限の誤り傾向
| quadrant | total | ood_rate | fp | fn |
|---|---:|---:|---:|---:|
| Q1(+u,+c) | 8930 | 0.861478 | 778 | 294 |
| Q2(-u,+c) | 982 | 0.191446 | 7 | 177 |
| Q3(-u,-c) | 9597 | 0.176305 | 211 | 1062 |
| Q4(+u,-c) | 491 | 0.869654 | 64 | 0 |

要点:
- FPは `Q1` に偏る。
- FNは `Q3` に偏る。
- 四象限分析により、単純なスコア比較では見えない失敗モードが分離される。

## 4. C) ロバスト性（prompt / seed / model）
- 設定:
  - prompt: `"a photo of {name}"`, `"a close-up photo of {name}"`
  - seed: `42,43,44`
  - model: `ViT-B-32`, `ViT-B-16`
- 結果:
  - 全runで `k=3`
  - 全runで `axis_u_index=2`, `axis_c_index=0`
  - cosine類似度は報告値で全て `1.0`

## 5. 前日報告との差分整理
- 旧参照値（例: `k=4`, `alpha=8.0`）は、4変数化前後の中間結果に依存していた。
- 本更新では、4変数版パイプラインで再計算した値に統一した。
- 今後はこのファイルを「当日確定値」の一次参照とする。
